var request = require("request");

// var options = { method: 'POST',
//   url: 'https://twinword-text-similarity-v1.p.mashape.com/similarity/',
//   headers:
//    { 'Postman-Token': '11c7854b-3f29-47ee-81e5-3aee77b45219',
//      'Cache-Control': 'no-cache',
//      'X-Mashape-Key': 'KaJd5e6lWAmshWITUI7kQC7xYVqnp1y4TYrjsnzCO3uKCAcgZg',
//      'Content-Type': 'application/x-www-form-urlencoded' },
//   form: { text1: 'This is a good book', text2: 'amazing book' } };
//
// request(options, function (error, response, body) {
//   if (error) throw new Error(error);
//
//   console.log(JSON.parse(body)["similarity"]);
// });



var elastic = [{"status": {"id": "d8fdd095-4265-4c32-98b9-d4a8852b7a5f", "name": "Hold"}, "category": {}, "last_updated": "2018-08-19 07:33:40", "description": "testing email and sms notification", "title": "Testing Notification", "park": {"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}, "comments": [], "priority": {"id": "5dfbbfd8-b9c8-4185-ab50-b8327938b60f", "name": "HIGH"}, "callback": "Yes", "image_url": "url to S3 bucket", "user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-19 07:33:40", "id": "bf76e02c-757b-4965-9ca1-b4ce4769d316"}, {"status": {"id": "89cf74ae-5c72-4ef4-9548-99bb73c4f760", "name": "Open"}, "category": {}, "last_updated": "2018-08-18 10:28:25", "description": "This is a sample description Arun", "title": "Title Sample Arun", "park": {"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}, "comments": [{"user": {"phone_token": "dude's address", "name": "Dudus Maximus", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}, {"description": "PAWNEE IS DA BEST!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample1.jpeg", "location": {"lat": "456", "long": "456"}, "address": "Pawnee, Indiana", "id": "51bf77ea-20be-4852-91fe-f0f3d85c0f37", "name": "Pawnee Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}, {"description": "PAWNEE IS DA BEST!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample1.jpeg", "location": {"lat": "456", "long": "456"}, "address": "Pawnee, Indiana", "id": "51bf77ea-20be-4852-91fe-f0f3d85c0f37", "name": "Pawnee Park"}], "time": "2018-08-18 10:15:22", "email": "dude's address", "phone": "6692924707", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/6edec494a3da92757b71ae6e98c36224.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "dude's address", "role": {"id": "70972379-2c6e-4bf0-890b-3cb71732eb8a", "name": "admin"}, "id": "e5bc8ecb-cda3-4935-a341-4ba5187c1b79"}, "time": "2018-08-19 15:01:05", "id": "d261de7a-f0e0-4d6d-be52-3b28e1c36bf4", "description": "This is not a sample"}], "priority": {"id": "ab8f4f5b-5182-4237-abe6-09daf4a6a039", "name": "LOW"}, "callback": "Yes", "image_url": "url to S3 bucket", "user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-18 10:28:25", "id": "de866ca0-2d2d-4cf7-bab1-3a567f01e74c"}, {"status": {"id": "792d064a-890c-438b-8f92-6ec961cb1ee5", "name": "In Progress"}, "category": {}, "last_updated": "2018-08-18 10:15:22", "description": "kjsdn", "title": "asdbj", "park": {"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}, "comments": [], "priority": {"id": "5dfbbfd8-b9c8-4185-ab50-b8327938b60f", "name": "HIGH"}, "callback": "No", "image_url": "url to S3 bucket", "user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-18 10:15:22", "id": "8558d77f-3629-4e74-8ada-951068934587"}, {"status": {"id": "792d064a-890c-438b-8f92-6ec961cb1ee5", "name": "In Progress"}, "category": {}, "last_updated": "2018-08-18 12:12:17", "description": "This is a sample description", "title": "Title Sample", "park": {"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}, "comments": [{"user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-18 10:11:15", "id": "01c3b8da-15db-42f0-a5a0-13a8bf35403a", "description": "This is a sample description"}, {"user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-19 15:59:15", "id": "4626cbef-b463-4566-9ddd-e5d7b2c547b2", "description": "This is a sample description 2"}, {"user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-19 16:15:03", "id": "a160f00b-c2dd-40c3-aa50-ba76c9dc5a69", "description": "test"}, {"user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-19 16:15:42", "id": "d9884ce3-38c3-403a-8d4f-a89b802a7fbf", "description": "final test"}], "priority": {"id": "5dfbbfd8-b9c8-4185-ab50-b8327938b60f", "name": "HIGH"}, "callback": "Yes", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/complaints/37086889-work-in-progress-road-sign.jpg", "user": {"phone_token": "Some dude's address", "name": "Some Dude", "subscribed_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "supervised_parks": [{"description": "This park is lame. PAWNEE RULES!!", "community": {"id": "5ab9174b-ace6-4db3-a220-b63a13950f23", "name": "Pawnee"}, "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/parks/parksample.jpg", "location": {"lat": "123", "long": "123"}, "address": "Eagleton, Indiana", "id": "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759", "name": "Eagleton Park"}], "time": "2018-08-18 10:15:22", "email": "Some dude's address", "phone": "6692350248", "image_url": "https://s3-us-west-1.amazonaws.com/lvivek.com/parks_and_rec/21_parkscartoonron.w529.h352.jpg", "location": {"lat": "420.42042", "long": "-69.696969"}, "address": "Some dude's address", "role": {"id": "1e29e5db-3c9f-4198-a5cc-c38ac59d9e46", "name": "user"}, "id": "a78afba2-fe86-4b93-a610-ae94f3599e90"}, "time": "2018-08-18 12:12:17", "id": "b4834341-56c4-429c-abc5-921cacc6e20a"}];
var park_id = "a2ad0f1d-1c45-4423-9fbe-cd43b3cf2759";
var input_title = "Sample";
var output = [];
var count =0;
function similarityCheck(text) {
    for (i in elastic) {
        if (park_id == elastic[i]["park"]["id"]) {
            var options = { method: 'POST',
                      url: 'https://twinword-text-similarity-v1.p.mashape.com/similarity/',
                      headers:
                       { 'Postman-Token': '11c7854b-3f29-47ee-81e5-3aee77b45219',
                         'Cache-Control': 'no-cache',
                         'X-Mashape-Key': 'KaJd5e6lWAmshWITUI7kQC7xYVqnp1y4TYrjsnzCO3uKCAcgZg',
                         'Content-Type': 'application/x-www-form-urlencoded' },
                      form: { text1: elastic[i]["title"], text2: text } };
                      //sendreq(elastic, options, i, output);
                      request(options, function (error, response, body) {
                      if (error) throw new Error(error);
                      count++;
                      if(count==options.length){
                      	return output;
                      }
                      if (parseFloat(JSON.parse(body)["similarity"]) > 0.60) {
                          output.push(elastic[i]);
                      }
				        console.log(output);
				        console.log('Length of output is ' + output.length + "  --  object structure " + output + " Compared to length of elastic is " + elastic.length);
				    
				     });


        }
    }
}


